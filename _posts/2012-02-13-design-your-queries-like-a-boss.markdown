---
layout: post
title: Design Your Queries Like A Boss
published: true
---
<p>As I often repeat the same advice on questions like "What to put in Propel Queries?", or&nbsp;"How to name things?", I decided to share it here.</p>
<p>When you design a software, it's <a href="http://williamdurand.fr/2012/01/24/designing-a-software-by-naming-things/">important to use appropriate names</a> for each part, each class, and even each method. In Propel, the ActiveQuery&nbsp;API is probably the most powerful part of your Model, that's why you should take care of it.<!--more--></p>
<p>First, you should&nbsp;use objects, and forget SQL. If you try to write Propel Queries like SQL queries, you are on the wrong path. A few months ago, someone complained about Propel queries on Twitter because he couldn't write a query. Here is my advice, and his answer:</p>
<blockquote class="twitter-tweet">
<p>that's because you're too close to a SQL mind, try to think with an object oriented mind :)</p>
&mdash; William DURAND (@couac) <a href="https://twitter.com/couac/status/123082534262280192">October 9, 2011</a></blockquote>

<blockquote class="twitter-tweet">
<p>@<a href="https://twitter.com/couac">couac</a> m.. yes, thinking about "traversing across object relations" instead of "let's retrieve data" may help when doing complex queries.thx</p>
&mdash; Nacho Mart&iacute;n (@nacmartin) <a href="https://twitter.com/nacmartin/status/123087738131066880">October 9, 2011</a></blockquote>

<p>That's exactly the point! Propel is an ORM you probably use in an OO framework, so why do you want to use SQL, or another query language?</p>
<p>Once you are aware of that, you'll be able to write queries offering the same advantages as objects: encapsulation, reusability, expressivity. The next step is to understand filters. Filters are reusable methods which add conditions to a query. In a Propel Query, you have generated filters like <code>filterById()</code>, <code>filterByUser()</code>, etc. which allow you to write nice queries:</p>
<p><script src="https://gist.github.com/1789608.js"></script></p>
<p>Custom filters have to follow the same convention. You can also wrap filter methods in methods with names that make sense:</p>
<p><script src="https://gist.github.com/1789643.js"></script></p>
<p>You should always name this kind of methods by describing a use case ;&nbsp;that's how you'll get a clean API. Methods in a Propel Query should always return <code>$this</code>&nbsp;to make the API fluent, and you should never add a termination method (<code>find()</code>, <code>count()</code>, etc.). It's the controller's responsability to determine which termination method is needed.</p>
<p>The last advice&nbsp;is about hub methods. Since a combination of filters can be a bit too long in a controller's action, you should write hub methods that combine filters to answer a specific use case. That way, a controller just needs to call this method, it's explicit, and short :)</p>
<p>You now have all keys to write awesome Propel Queries!</p>
